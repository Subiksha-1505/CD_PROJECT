<!DOCTYPE html>
<html>
<head>
    <title>Quiz</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/quiz.css') }}">
</head>

<body class="quiz-bg">
    <script>
        const studentClass = "{{ student_class }}";
        const subject = "{{ subject }}";
    </script>
   
<div class="quiz-container">

    <div class="quiz-header">
        <h2>Student Quiz</h2>
        <p>Answer all questions carefully</p>
    </div>
    <div id="timer" style="font-weight:bold; font-size:16px; margin-top:10px;">
        Time Left: 00:00
    </div>
    <!-- QUESTIONS WILL LOAD HERE -->
    <div id="quiz"></div>
    <button class="submit-btn" onclick="submitQuiz()">Submit Quiz</button>

</div>
<script src="{{ url_for('static', filename='js/quiz.js') }}"></script>
<script>

const quizDiv = document.getElementById("quiz");

// Render questions
questions.forEach((q, index) => {
    quizDiv.innerHTML += `
        <div class="question-card">
            <span class="question-number">Question ${index + 1}</span>
            <div class="question-text">${q.question}</div>

            ${q.options.map((opt, i) => `
                <label class="option">
                    <input type="radio" name="q${index}" value="${i}">
                    ${opt}
                </label>
            `).join("")}
        </div>
    `;
});

// Timer
let time = 60;
const timerElement = document.getElementById("timer");

const timer = setInterval(() => {
    timerElement.innerText = time + "s";
    time--;
    if (time < 0) {
        clearInterval(timer);
        submitQuiz();
    }
}, 1000);

function submitQuiz() {
    let score = 0;
    let correct = 0;
    let wrong = 0;
    let unanswered = 0;

    questions.forEach((q, index) => {
        const selected = document.querySelector(`input[name="q${index}"]:checked`);

        if (!selected) {
            unanswered++;
        } else if (parseInt(selected.value) === q.answer) {
            score++;
            correct++;
        } else {
            wrong++;
        }
    });

    // Replace quiz with result
    document.querySelector(".quiz-container").innerHTML = `
        <div class="quiz-header">
            <h2>Quiz Result</h2>
            <p>Your Performance Summary</p>
        </div>

        <div class="question-card">
            <p><strong>Total Questions:</strong> ${questions.length}</p>
            <p><strong>Correct Answers:</strong> ${correct}</p>
            <p><strong>Wrong Answers:</strong> ${wrong}</p>
            <p><strong>Unanswered:</strong> ${unanswered}</p>
            <p style="font-size:20px; margin-top:15px;">
                <strong>Your Score:</strong> ${score} / ${questions.length}
            </p>
        </div>

        <button class="submit-btn" onclick="location.reload()">Retry Quiz</button>
    `;
}
</script>
<script>
let totalTime = 1 * 60; // 10 minutes

function startTimer() {
    const timerEl = document.getElementById("timer");

    const interval = setInterval(() => {
        let minutes = Math.floor(totalTime / 60);
        let seconds = totalTime % 60;

        timerEl.innerText = `Time Left: ${minutes}:${seconds < 10 ? '0' : ''}${seconds}`;
        totalTime--;

        if (totalTime < 0) {
            clearInterval(interval);
            alert("Time is up! Submitting quiz â°");
            submitQuiz();
        }
    }, 1000);
}

startTimer();
</script>
</body>
</html>